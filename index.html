<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<title>Trustline Lookup</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="./css/bootstrap.min.css">
	<script src="./js/jquery.min.js"></script>
	<script src="./js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="css/sheet.css">
</head>
<style>
.back {
  background: #e2e2e2;
  width: 100%;
  position: absolute;
  top: 0;
  bottom: 0;
}

.div-center {
  width: 400px;
  height: 300px;
  background-color: #fff;
  left: 0;
  right: 0;
  top: 0;
  buttom: 0;
  margin: auto;
  max-width: 100%;
  max-height: 100%;
  overflow: auto;
  padding: 1em 2em;
  border-bottom: 2px solid #ccc;
  display: table;
}

div.content {
  width: 400px;
  height: 300px;
}
</style> 
<body>
	<div class="back">
		<div class="row">
			<div class="div-center">
				<div class="content">
				  <h3>XRP Trustline Lookup</h3>
				  <hr/>
				  <form>
					<div class="form-group">
					  <label for="exampleInputEmail1">Issuer Address</label>
					  <input type="email" class="form-control" id="issuerAddress">
					</div>
					<div class="form-group">
					  <label for="exampleInputPassword1">Your Address</label>
					  <input type="email" class="form-control" id="classicAddress">
					</div>
					<button id="search" class="btn btn-primary" style="width: 100%;">Search</button>
					<hr />
				  </form>
				</div>
			</div>			
		</div>
		<div class="row">
			<div class="div-center">
				<div class="content">
				  <div class="form-group">
					  <label for="exampleInputEmail1">Number of trustlines</label>
					  <input type="email" class="form-control" id="numTrusts" disabled>
					</div>
					<div class="form-group">
					  <label for="exampleInputPassword1">Your order</label>
					  <input type="email" class="form-control" id="yourOrder" disabled>
					</div>
				</div>
			</div>			
		</div>		
	</div>
</body>
<script>
		$(document).ready(function(){
		
			var issuerAddress = $("#issuerAddress").val();
			var classicAddress = $("#classicAddress").val();
			
			$("#search").click(function(){
				$.ajax({
					type: "GET",
					url: 'https://api.xrpscan.com/api/v1/account/' + issuerAddress + '/trustlines',
					beforeSend: function() {
						$("#search").text("Loading...");
						$("#numTrusts").val("");
						$("#yourOrder").val("");
					},
					success: function(data) {
						$("#search").text("Search");
						findYourOrder(data, classicAddress);
					}
				});				
			});	
		});

	    function findYourOrder(data, classicAddress) {
			$.each(data, function(ind, obj){
				if (obj.specification.counterparty == classicAddress) {
					$("#yourOrder").val(ind + 1);
					return false;
				}
			});
			$("#numTrusts").val(data.length);
		}
	</script>
</html>


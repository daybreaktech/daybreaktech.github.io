<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<title>Trustline Lookup</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="./css/bootstrap.min.css">
	<script src="./js/jquery.min.js"></script>
	<script src="./js/bootstrap.min.js"></script>
</head>
<style>
.back {
  background: #e2e2e2;
  width: 100%;
  position: absolute;
  top: 0;
  bottom: 0;
}

.div-center {
  width: 400px;
  height: 300px;
  background-color: #fff;
  left: 0;
  right: 0;
  top: 0;
  buttom: 0;
  margin: auto;
  max-width: 100%;
  max-height: 100%;
  overflow: auto;
  padding: 1em 2em;
  border-bottom: 2px solid #ccc;
  display: table;
}

div.content {
  width: 400px;
  height: 300px;
}
</style> 
<body>
	<div class="back">
		<div class="row">
			<div class="div-center">
				<div class="content">
				  <h3>XRP Trustline Lookup</h3>
				  <hr/>
					<div class="form-group">
					  <label for="floatingInput">Issuer Address <a id="help" href="javascript:void();">(?)</a></label>	
					  <input type="text" class="form-control" id="issuerAddress" placeholder="e.g) rw1rvdHuTE5gFmv6Sqy7rAYVmBQuXk3Ewh">
					</div>
					<div class="form-group">
					  <label for="floatingInput">Your Address</label>
					  <input type="text" class="form-control" id="classicAddress" placeholder="e.g) rHm8VBgtAwKAWyueyhrDxDfwQ5k2M6Tz3W">
					</div>
					<button id="search" class="btn btn-primary" style="width: 100%;">Search</button>
					<hr />
				</div>
			</div>			
		</div>
		<div class="row">
			<div class="div-center">
				<div class="content">
				  <div class="form-group">
					  <label for="exampleInputEmail1">Number of trustlines</label>
					  <input type="text" class="form-control" id="numTrusts" disabled>
					</div>
					<div class="form-group">
					  <label for="exampleInputPassword1">Your order</label>
					  <input type="text" class="form-control" id="yourOrder" disabled>
					</div>
				</div>
			</div>			
		</div>		
	</div>
	
<!-- Modal -->
<div class="modal fade" id="thisModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <img src="https://gcdn.pbrd.co/images/kCyyJQGbJWcG.png?o=1"></img>
    </div>
  </div>
</div>	
</body>
<script>
		$(document).ready(function(){
		
			$("#help").click(function(){
				$('#thisModal').modal('show')
			});
			
			$("#search").click(function(){
				var issuerAddress = $("#issuerAddress").val();
				var classicAddress = $("#classicAddress").val();
				$.ajax({
					type: "GET",
					url: 'https://api.xrpscan.com/api/v1/account/' + issuerAddress + '/trustlines',
					beforeSend: function() {
						$("#search").text("Loading...");
						$("#numTrusts").val("");
						$("#yourOrder").val("");
					},
					success: function(data) {
						$("#search").text("Search");
						findYourOrder(data, classicAddress);
					}
				});				
			});	
		});

	    function findYourOrder(data, classicAddress) {
			var yourOrder = "";
			$.each(data, function(ind, obj){
				if (obj.specification.counterparty == classicAddress) {
					yourOrder = ind + 1;
					return false;
				}
			});
			
			if (yourOrder == "") {
				$("#yourOrder").val("Your address not found!!");
			} else {
				$("#yourOrder").val(yourOrder);
			}
			
			$("#numTrusts").val(data.length);
		}
	</script>
</html>

